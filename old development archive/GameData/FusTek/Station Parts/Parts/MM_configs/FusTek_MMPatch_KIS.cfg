// Kerbal Inventory System (KIS) patch for FusTek Station Parts
// Author: Robin "sumghai" Chang
// Revision: 1.0
//
// For use with KIS v1.1.5

// This adds KIS support to the station modules in the following manner:
// - Selected modules will now hold varying amounts of KIS inventory slots
// - The Node Covers and the 1.25m diameter IACBM docking port can be retrofitted into the side nodes of the Karmony Node and compactNode Mk III Modules, via Kerbals on EVA
// - [Future] Removable FusTek FLEXrack containers for the Karmony Warehouse Module and various other FLEXrack carriers
// - [Future] Assembly of station truss segments, via Kerbals on EVA

// ----INVENTORY SLOT ALLOCATION----
// A typical internal locker has an approximate capacity of 12 L.
//
// Add 24 inventory slots to the Logistics Modules
@PART[FusTekKarmonyStorModule*]:NEEDS[KIS]:Final
{
  	MODULE
  	{
		name = ModuleKISInventory
		maxVolume = 288
		externalAccess = false  // Kerbals on EVA aren't supposed to be able to grab stuff directly from Logistics Modules
		internalAccess = true   // On the other hand, they are allowed to do so when inside the station / outpost
		slotsX = 6
		slotsY = 4
		slotSize = 50
		itemIconResolution = 128
		selfIconResolution = 128
		openSndPath = KIS/Sounds/containerOpen
		closeSndPath = KIS/Sounds/containerClose
		defaultMoveSndPath = KIS/Sounds/itemMove
	}
}

// Add 16 inventory slots to the Node Modules
@PART[FusTekKarmonyNodeMkIII*]:NEEDS[KIS]:Final
{
  	MODULE
	{
		name = ModuleKISInventory
		maxVolume = 192
		externalAccess = false  // Kerbals on EVA aren't supposed to be able to grab stuff directly from Node Modules
		internalAccess = true   // On the other hand, they are allowed to do so when inside the station / outpost
		slotsX = 4
		slotsY = 4
		slotSize = 50
		itemIconResolution = 128
		selfIconResolution = 128
		openSndPath = KIS/Sounds/containerOpen
		closeSndPath = KIS/Sounds/containerClose
		defaultMoveSndPath = KIS/Sounds/itemMove
	}
}

// Add 4 inventory slots to the Airlock Modules
@PART[FusTekKuest*]:NEEDS[KIS]:Final
{
  	MODULE
	{
		name = ModuleKISInventory
		maxVolume = 48
		externalAccess = false  // The EVA equipment locker is located behind the lockout chamber, so Kerbals are supposed to have everything they need before they set out on EVA
		internalAccess = true   // On the other hand, they are allowed transfer stuff to/from other modules inside the station / outpost
		slotsX = 1
		slotsY = 4
		slotSize = 50
		itemIconResolution = 128
		selfIconResolution = 128
		openSndPath = KIS/Sounds/containerOpen
		closeSndPath = KIS/Sounds/containerClose
		defaultMoveSndPath = KIS/Sounds/itemMove
	}
}

// Add 16 inventory slots to the Resupply Modules
@PART[FusTekResupplyModule*]:NEEDS[KIS]:Final
{
  	MODULE
	{
		name = ModuleKISInventory
		maxVolume = 192
		externalAccess = false  // Kerbals on EVA aren't supposed to be able to grab stuff directly from Resupply Modules
		internalAccess = true   // On the other hand, they are allowed to do so when inside the station / outpost
		slotsX = 4
		slotsY = 4
		slotSize = 50
		itemIconResolution = 128
		selfIconResolution = 128
		openSndPath = KIS/Sounds/containerOpen
		closeSndPath = KIS/Sounds/containerClose
		defaultMoveSndPath = KIS/Sounds/itemMove
	}
}

// ----NODE MODULE RETROFIT----
//
// Allow retrofitting of Node Covers and 1.25m diameter IACBM docking ports into the four side nodes of the Karmony Node Mk III Modules, via Kerbals on EVA
@PART[FusTekKarmonyNodeMkIII*]:NEEDS[KIS]:Final
{
	MODULE
	{
        	name = ModuleKISPartMount
                mountedPartNode = bottom
        	allowRelease = false
        	MOUNT
        	{
            		attachNode = left
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = right
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = front
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = back
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
    	}
}

// Allow retrofitting of Node Covers and 1.25m diameter IACBM docking ports into the four side nodes of the Karmony compactNode Mk III Modules, via Kerbals on EVA
@PART[FusTekKarmonyCompactNodeMkIII*]:NEEDS[KIS]:Final
{
	MODULE
	{
        	name = ModuleKISPartMount
                mountedPartNode = bottom
        	allowRelease = false
        	MOUNT
        	{
            		attachNode = left
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = right
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = front
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
        	MOUNT
        	{
            		attachNode = back
            		allowedPartName = FusTekKarmonyNodeCover
            		allowedPartName = FusTekKarmonyNodeCoverViewport
            		allowedPartName = IACBM125m
        	}
    	}
}

// Define behaviour of Karmony Node Cover part(s) when manipulated by Kerbal(s) on EVA
@PART[FusTekKarmonyNodeCover*]:NEEDS[KIS]:Final
{
	MODULE
	{
	        name = ModuleKISItem
	        useName = Retrofit
	        usableFromEva = true
	        usableFromContainer = true
	        usableFromPod = true
	        usableFromEditor = true
	        stackable = false
	        volumeOverride = 0
	        editorItemsCategory = false
	        moveSndPath = KIS/Sounds/itemMove
	        equipMode = part
	        equipSlot = jetpack
		equipMeshName = jetpack_base01
		equipBoneName = bn_jetpack01
	        equipPos = (0,0.21,-0.3)
		equipDir = (280,0,0)
	        carriable = true
	}
	
	MODULE
	{
    		name = ModuleKISItemEvaTweaker
        	walkSpeed = 0.4
        	runSpeed = 1.1
        	ladderSpeed = 0.3
        	swimSpeed = 0.4
        	maxJumpForce = 0.1
	}
}

// Define behaviour of 1.25m diameter IACBM125 docking port when manipulated by Kerbal(s) on EVA
@PART[IACBM125m]:NEEDS[KIS]:Final
{
	MODULE
	{
	        name = ModuleKISItem
	        useName = Retrofit
	        usableFromEva = true
	        usableFromContainer = true
	        usableFromPod = true
	        usableFromEditor = true
	        stackable = false
	        volumeOverride = 0
	        editorItemsCategory = false
	        moveSndPath = KIS/Sounds/itemMove
	        equipMode = part
	        equipSlot = jetpack
		equipMeshName = jetpack_base01
		equipBoneName = bn_jetpack01
	        equipPos = (0,0.21,-0.3)
		equipDir = (280,0,0)
	        carriable = true
	}
	
	MODULE
	{
    		name = ModuleKISItemEvaTweaker
        	walkSpeed = 0.2
        	runSpeed = 0.55
        	ladderSpeed = 0.15
        	swimSpeed = 0.2
        	maxJumpForce = 0
	}
}

// ----FLEXRACKS----
//
// Details to come

// ----TRUSSES----
//
// Details to come
